// neko8.c
// ・速度アップ（usleep短め）
// ・右端まで行ったら左へ折り返し（バウンド）
// ・表情3パターン（値=2の目パーツの表示を切り替え）
// ・16x16のドット絵フレーム（提供データ）を横スクロール表示
// 端末はANSIエスケープが使える環境を想定（macOS/Linuxのターミナル）

#include <stdio.h>
#include <unistd.h>   // usleep
#include <stdbool.h>  // bool
#include <stdlib.h>   // atexit

#define FRAMES 5
#define H 16
#define W 16

static const unsigned char a[FRAMES][H][W] = {
    {
        {0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0},
        {0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0},
        {0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0},
        {0,0,0,1,0,1,1,1,1,1,1,0,1,0,0,0},
        {0,0,1,0,0,1,1,1,1,1,1,0,0,1,0,0},
        {0,0,1,0,1,1,1,1,1,1,1,1,0,1,0,0},
        {0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0},
        {0,1,1,1,1,1,0,0,0,0,1,1,1,1,1,0},
        {0,1,1,1,1,1,0,0,0,0,1,1,1,1,1,0},
        {0,0,1,1,0,0,1,0,0,1,0,0,1,1,0,0},
        {0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0},
        {0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,2,2,2,2,0,0,0,0,0,0},
    },
    {
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
        {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
        {1,1,1,1,0,1,0,0,0,1,1,1,1,1,1,1},
        {0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0},
        {0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0},
        {0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,2,2,2,2,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
    },
    {
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,2,2,2,1,0,0,0,0,0,0},
        {0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0},
        {0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0},
        {0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0},
        {0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0},
        {0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0},
        {0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0},
        {0,0,0,0,0,0,1,2,2,1,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,2,2,2,2,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
    },
    {
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0},
        {0,0,0,1,0,0,1,1,1,1,0,0,1,0,0,0},
        {0,0,1,1,0,1,1,1,1,1,1,0,1,1,0,0},
        {0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0},
        {0,0,1,1,1,1,1,0,0,1,1,1,1,1,0,0},
        {0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0},
        {0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0},
        {0,0,0,1,1,1,1,0,0,1,1,1,1,0,0,0},
        {0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,2,2,2,2,0,0,0,0,0,0},
    },
    {
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0},
        {0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0},
        {0,0,0,1,0,0,1,1,1,1,0,0,1,0,0,0},
        {0,0,1,1,0,1,1,1,1,1,1,0,1,1,0,0},
        {0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0},
        {0,0,1,1,1,1,1,0,0,1,1,1,1,1,0,0},
        {0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0},
        {0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0},
        {0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0},
        {0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,2,2,2,2,0,0,0,0,0,0},
    },
};

// 表示に使う文字（0=空白、1=体、2=目）
// 表情3パターンで目（2）の文字を切り替える
static const char *eye_patterns[3] = { "oo", "OO", "--" }; // 2文字を交互に使う
static const char body_char[] = "██";  // 見やすいよう2文字（全角や太めが出ない端末は"##"等に変更可）

static void restore(void) {
    // 折り返しON, カーソル表示 ON
    printf("\e[?7h\e[?25h\e[0m\n");
    fflush(stdout);
}

static inline void put_indent(int n) {
    for (int i = 0; i < n; i++) putchar(' ');
}

// x: 横インデント, f: フレーム番号, expr: 0/1/2
static void draw(int x, int f, int expr) {
    // 画面クリア＋原点へ。折り返しOFF、カーソル非表示
    printf("\e[H\e[J\e[?7l\e[?25l");

    for (int r = 0; r < H; r++) {
        put_indent(x);
        for (int c = 0; c < W; c++) {
            unsigned char v = a[f][r][c];
            if (v == 0) {
                printf("  "); // 0は2桁分の空白
            } else if (v == 1) {
                // 体
                printf("%s", body_char);
            } else { // v == 2 目
                // 目は表情に合わせて "oo" / "OO" / "--" を交互に置く
                const char *eyes = eye_patterns[expr % 3];
                // 左右で文字を変えてチラつきを出す
                if ((c % 2) == 0) {
                    printf("%c ", eyes[0]);
                } else {
                    printf(" %c", eyes[1]);
                }
            }
        }
        putchar('\n');
    }
    fflush(stdout);
}

int main(void) {
    atexit(restore);

    int x = 0;
    int dx = 1;          // +1で右へ、-1で左へ
    const int XMIN = 0;
    const int XMAX = 60; // 端末幅に合わせて調整（広ければ増やす）

    int f = 0;           // フレーム（0..FRAMES-1）
    int expr = 0;        // 表情（0..2）

    while (1) {
        draw(x, f, expr);

        // 速度：0.07秒（授業のneko7.cより速め）
        usleep(70000);

        // 次の状態へ
        x += dx;
        if (x >= XMAX) { x = XMAX; dx = -1; }
        if (x <= XMIN) { x = XMIN; dx =  1; }

        // フレームと表情を進める
        f = (f + 1) % FRAMES;
        // ある程度進んだら表情を変える（好みで調整）
        if (f == 0) expr = (expr + 1) % 3;
    }
    return 0;
}